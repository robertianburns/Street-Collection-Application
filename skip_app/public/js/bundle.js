const customIcons={userIcon:L.icon({iconUrl:"./images/user.png",iconSize:[48,48],iconAnchor:[24,24]})};window.addEventListener("load",(()=>{navigator.serviceWorker.register("./sw.js",{scope:"./"});const e=L.map("map").fitWorld(),t=(new L.LayerGroup).addTo(e);let o,n;L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw",{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1}).addTo(e),e.locate({setView:!0,maxZoom:16,watch:!1});let a=null;"geolocation"in navigator?navigator.geolocation.getCurrentPosition((t=>{o=t.coords.latitude,n=t.coords.longitude,null==a?a=L.marker([o,n],{icon:customIcons.userIcon}).addTo(e):a.setLatLng([o,n])})):alert("ERROR CODE CATERPILLAR: Failed to get your location. A possible fix might be to enable location access and try again.");document.querySelector("#addButton").addEventListener("click",(()=>{const e=document.querySelector("#addMenu");"block"==e.style.display?e.style.display="none":e.style.display="block"}));const c=document.querySelector("#canvas"),i=c.getContext("2d");function r(){let e=this.width/this.height,t=c.width,o=t/e;o>c.height&&(o=c.height,t=o*e);const n=t<c.width?(c.width-t)/2:0,a=o<c.height?(c.height-o)/2:0;i.clearRect(0,0,c.width,c.height),i.drawImage(this,n,a,t,o)}function s(){alert("ERROR CODE CAT: The given file could not be loaded as an image. Please make sure the file is an image and try again.")}document.querySelector("#fileInput").onchange=function(e){const t=new Image;t.onload=r,t.onerror=s,t.src=URL.createObjectURL(this.files[0])};async function d(){const o=await fetch("/skip_app"),n=await o.json();for(object of(t.clearLayers(),n)){const o=L.marker([object.lat,object.lon]).addTo(t),n=object._id,a=`<img src="${object.imageURL}" />`,c=object.objectDescription,i=`<br/><button type="button" class="button" id="${n}">Object Taken?</button>`,r="<br />";document.body.addEventListener("click",(async t=>{if(t.target.id==n){fetch(`/skip_app/${n}`,{method:"PUT"}),e.removeLayer(o)}})),1===object.objectTaken?e.removeLayer(o):o.bindPopup(a+r+c+r+i,{maxWidth:"auto"})}}document.querySelector("#submit").addEventListener("click",(async e=>{const t=document.querySelector("#canvas").toDataURL(),a=document.querySelector("#objDescription").value,c={objectTaken:0,lat:o,lon:n,objectDescription:a,imageURL:t},i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)};fetch("/skip_app",i),document.querySelector("#addMenu").style.display="none",setTimeout(d,500)})),document.querySelector("#closeaddMenu").addEventListener("click",(function(){document.querySelector("#addMenu").style.display="none"})),d()}));